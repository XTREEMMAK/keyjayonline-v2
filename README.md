<p align="center">
  <img src="/static/img/KJ_Logo_Medium_W.svg" alt="Key Jay Logo" width="200">
</p>

# KEY JAY ONLINE v2

<p align="center">The official website and portfolio for musician, creative, tech enthusiast, and producer Key Jay!</p>

## Tech Stack

- **Framework**: SvelteKit 2 + Svelte 5
- **Styling**: Tailwind CSS 4 + Neumorphic design system
- **CMS**: [Directus](https://directus.io/) (headless CMS)
- **CDN**: DigitalOcean Spaces (S3-compatible) via `paths.assets`
- **Audio**: Wavesurfer.js
- **Filtering**: MixItUp 3 (animated filtering & sorting)
- **Icons**: Iconify
- **Hosting**: Docker on DigitalOcean

## Sections

- **About** - Bio, social links, featured work
- **Music** - Albums, latest projects, new releases, legacy works, studio gear
- **Tech** - Technical projects and showcases
- **Productions** - Films, comics, games, and creative productions with embeds, credits, galleries, and audio playlists

## Quick Start

```bash
# Clone and install
git clone <repository-url>
cd keyjayonline.com_v2
npm install

# Create local env files
cp .env.example .env.local
cp .env.example .env.development
# Edit both with your values (see Environment Setup below)

# Start development server
npm run dev
```

Visit `http://localhost:5173` to see the site.

## Environment Setup

This project uses Vite's auto-loading for environment files:

| File | Purpose | Git Status |
|------|---------|------------|
| `.env.example` | Template with all available variables | Committed |
| `.env.development` | Dev config (non-secrets: URLs, ports) | Ignored |
| `.env.local` | Dev secrets (tokens, passwords) | Ignored |
| `.env.docker.local` | Docker dev secrets (DB, Directus keys) | Ignored |
| `.env` | Production (auto-generated by CI/CD) | Ignored |

**Required in `.env.local`:**
- `DIRECTUS_TOKEN` - API token for Directus
- `DEV_ADMIN_PASSWORD` - Directus admin password (for `schema:snapshot`)

**Required in `.env.development`:**
- `DIRECTUS_URL` - Directus instance URL
- `PUBLIC_SITE_URL` - Site URL (e.g., `http://localhost:5173`)
- `PUBLIC_CONTACT_EMAIL` - Contact form email

**Required in `.env.docker.local`** (for Docker development only):
- `DB_PASSWORD`, `DIRECTUS_KEY`, `DIRECTUS_SECRET`, `DIRECTUS_ADMIN_PASSWORD`, `DIRECTUS_TOKEN`

See `.env.example` for all available variables and [DEVELOPMENT.md](docs/DEVELOPMENT.md) for detailed setup.

## CDN Architecture

SvelteKit's `paths.assets` is set to `CDN_BASE_URL` in production, so all client assets (JS bundles, CSS, images) load from the CDN instead of the app server.

- **CI auto-uploads** `build/client/` to S3 on every deploy (includes `_app/`, `img/`)
- **Videos/audio** are gitignored and uploaded manually via `npm run cdn:sync`
- **Directus uploads** live in the same S3 bucket under separate paths

See [DEPLOYMENT.md](docs/DEPLOYMENT.md) for CORS configuration and CDN details.

## Scripts

```bash
# Development
npm run dev              # Development server
npm run build            # Production build
npm run preview          # Preview production build

# Content & Schema
npm run cdn:sync         # Upload local videos/audio to CDN
npm run schema:snapshot  # Export Directus schema from dev to docker/directus/schema.json

# Docker
npm run docker:init      # First-time: start Directus + Postgres only
npm run docker:up        # Start all Docker containers
npm run docker:down      # Stop Docker containers
npm run docker:logs      # View Docker logs
npm run docker:build     # Rebuild app Docker image
```

## Project Structure

```
src/
├── lib/
│   ├── api/             # Directus API layer
│   │   ├── core/        # Client, assets, shared transforms
│   │   ├── content/     # Music, productions, tech, voice, etc.
│   │   ├── site/        # Settings, navigation
│   │   └── social/      # Social links
│   ├── actions/         # Svelte actions (letter animation, etc.)
│   ├── components/
│   │   ├── sections/    # Page sections (Music, Tech, Productions, Voice)
│   │   ├── music/       # Album modals, players, release cards
│   │   ├── tech/        # Tech project cards and showcases
│   │   ├── layout/      # Featured work, hero sections
│   │   ├── forms/       # Contact form
│   │   └── ui/          # Navbar, sticky nav, scroll-to-top, modals
│   ├── stores/          # Svelte stores (navigation, music player, sticky nav)
│   ├── styles/          # CSS (neumorphic system, modal styles)
│   ├── utils/           # Utility functions (YouTube, external links, image cache)
│   └── data/            # Static data files
├── routes/
│   ├── share/           # Shareable links (album, sample, voice, production)
│   └── +page.svelte     # Main single-page app
├── static/              # Static assets (img/, videos/, audio/)
docker/
├── directus/            # Schema snapshot (schema.json)
├── postgres/            # PostgreSQL init script
└── scripts/             # Container startup scripts (first-run.sh)
```

## Deployment

Production deployments are automated via GitHub Actions on push to `main`:

1. Build application
2. Upload client assets to CDN (S3)
3. Build Docker image and push to ghcr.io
4. SSH to server, generate `.env` from GitHub Secrets
5. `docker compose up` with health check and backup
6. Directus applies schema snapshot on startup via `first-run.sh`

See [DEPLOYMENT.md](docs/DEPLOYMENT.md) for full details, required secrets, and schema management.

## Development

See [DEVELOPMENT.md](docs/DEVELOPMENT.md) for Docker setup, environment configuration, schema management, and troubleshooting.

## License

All rights reserved.
